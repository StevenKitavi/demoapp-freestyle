jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Download and Run Legitify Manually
        env:
          GITHUB_TOKEN: ${{ secrets.PAT_FOR_LEGITIFY }}
        run: |
          # Download Legitify
          wget https://github.com/Legit-Labs/legitify/releases/download/v1.0.11/legitify_1.0.11_linux_amd64.tar.gz
          tar -xzf legitify_1.0.11_linux_amd64.tar.gz
          chmod +x legitify
          
          # Run analysis with verbose output
          echo "=== RUNNING LEGITIFY ANALYZE ==="
          ./legitify analyze --org StevenKitavi --output-format json --output-file legitify-output.json -v
          
          # Check results
          echo "=== CHECKING RESULTS ==="
          ls -la
          if [ -f legitify-output.json ]; then
            echo "✅ Results generated!"
            cat legitify-output.json
          else
            echo "❌ No output generated"
          fi
